ArticleEditor.add("plugin","slideshow",{translations:{en:{slideshow:{slideshow:"Slideshow",save:"Save",cancel:"Cancel",insert:"Insert"}}},defaults:{upload:!1,select:!1,name:"file",data:!1,multiple:!0},popups:{add:{title:"## slideshow.slideshow ##",width:"100%",footer:{insert:{title:"## slideshow.insert ##",command:"slideshow.insert",type:"primary"},cancel:{title:"## slideshow.cancel ##",command:"popup.close"}}},edit:{title:"## slideshow.slideshow ##",width:"100%",footer:{save:{title:"## slideshow.save ##",command:"slideshow.save",type:"primary"},cancel:{title:"## slideshow.cancel ##",command:"popup.close"}}}},start:function(){this.app.addbar.add("slideshow",{title:"## slideshow.slideshow ##",icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m1 6c.51283584 0 .93550716.38604019.99327227.88337887l.00672773.11662113v6c0 .4964612.44481521.9373059 1.049825.9938787l.13199318.0061213h5.81818182c.55228475 0 1 .4477153 1 1 0 .5128358-.38604019.9355072-.88337887.9932723l-.11662113.0067277h-5.81818182c-1.67882337 0-3.08194674-1.2331302-3.17671765-2.8277989l-.00510053-.1722011v-6c0-.55228475.44771525-1 1-1zm12.6-6c1.3254834 0 2.4 1.0745166 2.4 2.4v8.2c0 .0812991-.0040424.161654-.0119371.2408747.04537.286293-.0350323.5849432-.229131.8106316-.3901386.7980655-1.2102555 1.3484937-2.1589319 1.3484937h-8.2c-.0093721 0-.01873166-.0000537-.02807838-.0001609l-.37192162.0001604c-.26521649 0-.5195704-.1053563-.70710678-.2928927l.05843073.052268c-.4838201-.2353989-.8766931-.6286113-1.11166129-1.1126794-.19291421-.2239005-.27189946-.5180346-.2277519-.8010756-.00769603-.0805757-.01191076-.1626056-.01191076-.2456198v-8.2c0-1.3254834 1.0745166-2.4 2.4-2.4zm-1.596 8.632-.76.937.839 1.431h1.517c.0486011 0 .0951777-.0086678.1382683-.0245418zm-4.582-1.631-2.176 3.83.169.169h4.349l-.436-.744-.04995732-.0453903c-.12825052-.1334488-.2131256-.2958557-.25256531-.46760617zm6.178-5.001h-8.2c-.2209139 0-.4.1790861-.4.4v4.814l1.53963435-2.70800941c.35805102-.6301698 1.23187816-.67285287 1.65793101-.12170559l.07440231.11030062 1.89203233 3.23141438 1.0987033-1.35538405c.384092-.47423473 1.0895396-.491008 1.4981306-.06381668l.0827862.09833145 1.1563799 1.56386928v-5.569c0-.19329966-.1371128-.35457492-.319386-.39187342z"/></svg>',command:"slideshow.popup"})},popup:function(){var s=this.app.popup.add("slideshow",this.popups.add),t=s.getBody();this.$box=this.dom("<div>").addClass(this.prefix+"-slideshow-items"),t.append(this.$box),this.$upload=this.app.image.createUploadBox(this.opts.slideshow.upload,t),this.app.image.createSelectBox(this.opts.slideshow.select,t,"slideshow.insertFromSelect"),s.open(),this._buildUpload(this.$upload,"slideshow.insertByUpload")},edit:function(s,t){var e=this.app.popup.create("slideshow",this.popups.edit).getBody(),i=this.app.block.get().getBlock().find("img");this.$box=this.dom("<div>").addClass(this.prefix+"-slideshow-items"),e.append(this.$box),i.each(function(s){this._buildBoxItem(s.attr("src"))}.bind(this)),this.$upload=this.app.image.createUploadBox(this.opts.slideshow.upload,e),this.app.image.createSelectBox(this.opts.slideshow.select,e,"slideshow.insertFromSelect"),this.app.popup.open({button:t}),this._buildUpload(this.$upload,"slideshow.insertByUpload")},insertByUpload:function(s){for(var t in s)this._buildBoxItem(s[t].url)},insertFromSelect:function(s){s.preventDefault();s=this.dom(s.target);this._buildBoxItem(s.attr("data-url"))},insert:function(){var s=this.app.create("block.uk-slideshow");this.app.block.add({instance:s}),this.save()},save:function(){var i,s=this.app.block.get(),t=this.$box.find("img");0===t.length?s.remove():((i=s.getBlock().find(".uk-slideshow-items")).html(""),t.each(function(s,t){var s=s.attr("src"),e=this.dom("<li>"),s=this.dom("<img>").attr({src:s,"uk-cover":!0});e.append(s),i.append(e)}.bind(this))),this.app.popup.close()},_removeItem:function(s){this.dom(s.target).closest("."+this.prefix+"-slideshow-item").fadeOut(function(s){s.remove()}.bind(this))},_buildBoxItem:function(s){var t=this.dom("<span>").addClass(this.prefix+"-slideshow-item"),e=this.dom("<span>").addClass(this.prefix+"-upload-remove"),s=this.dom("<img>").attr("src",s);e.one("click",this._removeItem.bind(this)),t.append(s),t.append(e),this.$box.append(t)},_buildUpload:function(s,t){this.opts.slideshow.upload&&(t={box:!0,placeholder:this.lang.get("image.upload-new-placeholder"),url:this.opts.slideshow.upload,name:this.opts.slideshow.name,data:this.opts.slideshow.data,multiple:this.opts.slideshow.multiple,success:t,error:"image.error"},this.app.create("upload",s,t))}});